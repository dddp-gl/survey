ğŸ–¥ï¸ ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ä½¿ã†æ–¹æ³•ï¼ˆCLIï¼‰
Firebase CLIï¼ˆfirebase-toolsï¼‰ã‚’ä½¿ãˆã°ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ“ä½œã§ãã¾ã™ã€‚

ğŸ”§ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
bash
npm install -g firebase-tools
ğŸ” ãƒ­ã‚°ã‚¤ãƒ³
bash
firebase login
Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼ã—ã¾ã™ã€‚

ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
bash
firebase init
å¯¾è©±å½¢å¼ã§è¨­å®šã‚’é€²ã‚ã¾ã™ã€‚Hosting ã‚„ Functions ãªã©ã€ä½¿ã„ãŸã„æ©Ÿèƒ½ã‚’é¸æŠã§ãã¾ã™ã€‚

ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤
bash
firebase deploy
è¨­å®šã—ãŸå†…å®¹ã«åŸºã¥ã„ã¦ Firebase ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚

CLI ã¯ä¸»ã«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚„ Functions ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã«ä½¿ã„ã¾ã™ã€‚

ğŸ’» Node.js ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã®ä½¿ã„æ–¹ï¼ˆAdmin SDKï¼‰
Firebase Admin SDK ã‚’ä½¿ã†ã¨ã€Node.js ã‹ã‚‰ç›´æ¥ Firebase ã®æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

ğŸ“¦ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
bash
npm install firebase-admin
ğŸ”‘ åˆæœŸåŒ–ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼‰
js
const admin = require('firebase-admin');
const serviceAccount = require('./path/to/serviceAccountKey.json');

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: 'https://your-project-id.firebaseio.com'
});
ğŸ” èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼
js
admin.auth().verifyIdToken(idToken)
  .then((decodedToken) => {
    const uid = decodedToken.uid;
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
  })
  .catch((error) => {
    // ã‚¨ãƒ©ãƒ¼å‡¦ç†
  });
ğŸ“š Firestore ã®æ“ä½œ
js
const db = admin.firestore();
const docRef = db.collection('users').doc('alice');

await docRef.set({ name: 'Alice', age: 30 });
Admin SDK ã¯ã€èªè¨¼ã€Firestoreã€Realtime Databaseã€Cloud Messaging ãªã©ã‚’å®Œå…¨ãªç®¡ç†è€…æ¨©é™ã§æ“ä½œã§ãã¾ã™3ã€‚



Firebase functionsã‚’å«ã‚ãŸã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§Firestoreã‚’æ“ä½œã™ã‚‹éš›ã€Firebase Admin SDKã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã—ã‹ã—ã€API Referenceã¯ã‚ã‚Šã¾ã™ãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯è¦‹å½“ãŸã‚Šã¾ã›ã‚“ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’æ“ä½œã™ã‚‹ã¨ãã«ç”¨ã„ã‚‹Firebase Javascript SDKã«æ¯”ã¹ã¦æƒ…å ±ãŒå°‘ãªã‹ã£ãŸã®ã§ã€ä¸€é€šã‚Šã®æ“ä½œæ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

è¿½è¨˜: å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’Node.jsã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ã€Firebase Admin SDKã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ãŒè¦‹ã‚Œã¾ã—ãŸï¼ˆæ°—ã¥ã‹ãªã‹ã£ãŸï¼‰ã€‚ã›ã£ã‹ãæ›¸ã„ãŸã®ã§å…¬é–‹ã—ã¾ã™ãŒã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚ã‚³ãƒ¼ãƒ‰ã®ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚Šã¾ã—ãŸã€‚

Firestore  |  Firebase

Firebase
å‰æ
Firebase Admin SDKã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ç„¡è¦–ã—ã¾ã™ã®ã§æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚

ã‚¯ãƒ©ã‚¤ã‚¨ãƒ³ãƒˆå´ã®SDK(Firebase Javascript SDK)ã¨åŒã˜ã‚ˆã†ãªåˆ¶ç´„ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã«ã¤ã„ã¦åŸºæœ¬çš„ã«èª¬æ˜ã—ãªã„ã®ã§ã‚¯ãƒ©ã‚¤ã‚¨ãƒ³ãƒˆå´ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ãã ã•ã„ã€‚

articlesã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚
fieldã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

{
  title: string
  userUid: string
  body: string
  public: boolean
  createdAt: timestamp
  updatedAt: timestamp
}
ä¿å­˜ã•ã‚Œã¦ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã¨ã—ã¾ã™ã€‚

[
  {
    public: true,
    title: '1',
    body: '1',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412862, _nanoseconds: 740000000 },
    updatedAt: Timestamp { _seconds: 1710412862, _nanoseconds: 740000000 }
  },
  {
    public: false,
    title: '2',
    body: '2',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412871, _nanoseconds: 89000000 },
    updatedAt: Timestamp { _seconds: 1710412871, _nanoseconds: 89000000 }
  },
  {
    public: true,
    title: '3',
    body: '3',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 },
    updatedAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 }
  },
  {
    public: true,
    title: "another user's 1",
    createdAt: Timestamp { _seconds: 1710416766, _nanoseconds: 516000000 },
    body: "another user's 1",
    updatedAt: Timestamp { _seconds: 1710416784, _nanoseconds: 973000000 },
    userUid: 'ADedsD44tdFGrfgerGFErgergRRR'
  }
]
ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Š
1ã¤ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å–å¾—
å˜ã«docãƒ¡ã‚½ãƒƒãƒ‰ã§uidã‚’æŒ‡å®šã—ã¦å–å¾—ã§ãã¾ã™ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const docRef = adminDb
  .collection("articles")
  .doc("R9szMVG0vsfd7iUx08Wq")
const docSnap = await docRef.get()

console.log(docSnap.data())
output

{
  public: true,
  title: '3',
  body: '3',
  userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
  createdAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 },
  updatedAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 }
}
è¤‡æ•°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å–å¾—
where()ãƒ•ã‚£ãƒ«ã‚¿ã‚’çœç•¥ã—ã¦ã™ã¹ã¦å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
where()ãƒ•ã‚£ãƒ«ã‚¿ã«ã¤ã„ã¦ã¯å¾Œã§ã‚‚ã†å°‘ã—è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const queryRef = adminDb
  .collection("articles")
  .where("public", "==", true)
const querySnap = await queryRef.get()

console.log(querySnap.docs.map((doc) => doc.data()))
output

[
  {
    public: true,
    title: '3',
    body: '3',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 },
    updatedAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 }
  },
  {
    public: true,
    title: '1',
    body: '1',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412862, _nanoseconds: 740000000 },
    updatedAt: Timestamp { _seconds: 1710412862, _nanoseconds: 740000000 }
  },
  {
    public: true,
    title: "another user's 1",
    createdAt: Timestamp { _seconds: 1710416766, _nanoseconds: 516000000 },
    body: "another user's 1",
    updatedAt: Timestamp { _seconds: 1710416784, _nanoseconds: 973000000 },
    userUid: 'ADedsD44tdFGrfgerGFErgergRRR'
  }
]
å˜ç´”ãªã‚¯ã‚¨ãƒªã§è¤‡æ•°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å–å¾—
where() ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã®SDKã¨åŒã˜æ¯”è¼ƒæ¼”ç®—å­ãŒä½¿ãˆã¾ã™ã€‚

<: ã‚ˆã‚Šå°ã•ã„
<=: ä»¥ä¸‹
== ç­‰ã—ã„
> ã‚ˆã‚Šå¤§ãã„
>= ä»¥ä¸Š
!= ç­‰ã—ããªã„
array-contains
array-contains-any
in
not-in
!=ã‚¯ã‚¨ãƒªå¥ã‚’ä½¿ã†éš›ã¯å¤šãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒä¸€è‡´ã™ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã€limitã‚’ä½¿ã†ã‚ˆã†ã«ã‚¯ãƒ©ã‚¤ã‚¨ãƒ³ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚ã¨ã„ã†ã‹!=ã‚¯ã‚¨ãƒªå¥ã‚’ä½¿ã‚ãªã„å ´åˆã‚‚limitä½¿ã„ã¾ã—ã‚‡ã†ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const queryRef = adminDb
  .collection("articles")
  .where("public", "==", true)
  .limit(1)
const querySnap = await queryRef.get()

console.log(querySnap.docs.map((doc) => doc.data()))
output

[
  {
    public: true,
    title: '3',
    body: '3',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 },
    updatedAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 }
  }
]
è¤‡åˆ(AND)ã‚¯ã‚¨ãƒªã§è¤‡æ•°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å–å¾—
admin.firestore.Filterã«and()ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const queryRef = adminDb
  .collection("articles")
  .where(
    admin.firestore.Filter.and(
      admin.firestore.Filter.where("public", "==", true),
      admin.firestore.Filter.where(
        "userUid",
        "==",
        "EVyT9uSk92ddwPeBMjElL5Qx6PCK"
      )
    )
  )
  .limit(5)
const querySnap = await queryRef.get()

console.log(querySnap.docs.map((doc) => doc.data()))
output

[
  {
    public: true,
    title: '3',
    body: '3',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 },
    updatedAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 }
  },
  {
    public: true,
    title: '1',
    body: '1',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412862, _nanoseconds: 740000000 },
    updatedAt: Timestamp { _seconds: 1710412862, _nanoseconds: 740000000 }
  }
]
è¤‡åˆ(OR)ã‚¯ã‚¨ãƒªã§è¤‡æ•°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å–å¾—
admin.firestore.Filterã«or()ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const queryRef = adminDb
  .collection("articles")
  .where(
    admin.firestore.Filter.or(
      admin.firestore.Filter.where("title", "==", "1"),
      admin.firestore.Filter.where("title", "==", "2")
    )
  )
  .limit(5)
const querySnap = await queryRef.get()

console.log(querySnap.docs.map((doc) => doc.data()))
output

[
  {
    public: true,
    title: '1',
    body: '1',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412862, _nanoseconds: 740000000 },
    updatedAt: Timestamp { _seconds: 1710412862, _nanoseconds: 740000000 }
  },
  {
    public: false,
    title: '2',
    body: '2',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412871, _nanoseconds: 89000000 },
    updatedAt: Timestamp { _seconds: 1710412871, _nanoseconds: 89000000 }
  }
]
ãƒ‡ãƒ¼ã‚¿ã‚’ä¸¦ã¹æ›¿ãˆãŸã‚Šåˆ¶é™ã™ã‚‹
orderBy()ã‚„limit()ã‚‚ã‚¯ãƒ©ã‚¤ã‚¨ãƒ³ãƒˆã¨åŒã˜ã‚ˆã†ã«ä½¿ãˆã¾ã™ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const queryRef = adminDb
  .collection("articles")
  .orderBy("createdAt", "desc")
  .limit(2)
const querySnap = await queryRef.get()

console.log(querySnap.docs.map((doc) => doc.data()))
output

[
  {
    public: true,
    title: "another user's 1",
    createdAt: Timestamp { _seconds: 1710416766, _nanoseconds: 516000000 },
    body: "another user's 1",
    updatedAt: Timestamp { _seconds: 1710416784, _nanoseconds: 973000000 },
    userUid: 'ADedsD44tdFGrfgerGFErgergRRR'
  },
  {
    public: true,
    title: '3',
    body: '3',
    userUid: 'EVyT9uSk92ddwPeBMjElL5Qx6PCK',
    createdAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 },
    updatedAt: Timestamp { _seconds: 1710412878, _nanoseconds: 245000000 }
  }
]
é›†è¨ˆã‚¯ã‚¨ãƒªã§ãƒ‡ãƒ¼ã‚¿ã‚’è¦ç´„ã™ã‚‹
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

count(), sum(), average()ã‚‚ä½¿ãˆã¾ã™ã€‚
ã“ã“ã§ã¯count()ã®ç´¹ä»‹ã ã‘ã«ã—ã¦ãŠãã¾ã™ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const queryRef = adminDb
  .collection("articles")
  .where("public", "==", true)
const snap = await queryRef.count().get()

console.log(snap.data().count)
output

3
ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ã€æ›´æ–°ã€å‰Šé™¤
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹
set()ã‚’ä½¿ã†ã¨è¿½åŠ ã¾ãŸã¯ä¸Šæ›¸ãã§ãã¾ã™ã€‚
ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã«ç¾æ™‚åˆ»ã‚’è¨­å®šã™ã‚‹ã«ã¯admin.firestore.FieldValue.serverTimestamp()ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const data = {
  public: true,
  title: "Add",
  body: "Add",
  userUid: "ADDUSERUID",
  createdAt: admin.firestore.FieldValue.serverTimestamp(),
  updatedAt: admin.firestore.FieldValue.serverTimestamp(),
}
adminDb.collection("articles").doc("ADDUID").set(data)
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹
uidã‚’æŒ‡å®šã—ãŸã„å ´åˆã¯set()ã‚’ä½¿ã„ã¾ã™ãŒã€è‡ªå‹•çš„ã«ç”Ÿæˆã—ãŸã„å ´åˆã¯add()ã‚’ä½¿ã„ã¾ã™ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

const data = {
  public: true,
  title: "Add",
  body: "Add",
  userUid: "ADDUSERUID",
  createdAt: admin.firestore.FieldValue.serverTimestamp(),
  updatedAt: admin.firestore.FieldValue.serverTimestamp(),
}
adminDb.collection("articles").add(data)
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹
ä¸€éƒ¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›´æ–°ã™ã‚‹ã«ã¯update()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã¾ã™ã€‚set()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦mergeã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€update()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†æ–¹ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚ç†ç”±ã¯Firebase Admin SDKã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ç„¡è¦–ã™ã‚‹ã®ã§ã€ãƒãƒ¼ã‚¸ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘å¿˜ã‚Œã‚‹ã¨ä¸€éƒ¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¶ˆã—ã¦ã—ã¾ã†ã‹ã‚‚ã—ã‚Œãªã„ã‹ã‚‰ã§ã™ï¼ˆã‚¯ãƒ©ã‚¤ã‚¨ãƒ³ãƒˆå´ã®SDKã ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®ãŠã‹ã’ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚‚å¤šã„ï¼‰ã€‚

import * as admin from "firebase-admin"

const adminDb = admin.firestore()

adminDb
  .collection("articles")
  .doc("ADDUID")
  .update({ title: "Update" })


  